## 问题491 题解

### 题目分析

这个问题要求我们对一个给定的二维数组进行多次矩形区域求和。这是一个非常经典的二维前缀和问题。如果对每次查询都遍历矩形区域来求和，在查询次数很多的情况下，效率会非常低下。

### 解题思路

我们可以使用二维前缀和来极大地优化查询效率。

1.  **预处理：构造二维前缀和数组**
    -   我们创建一个二维数组 `prefix_sum`，其中 `prefix_sum[i][j]` 存储了从左上角 `(1, 1)` 到 `(i, j)` 的矩形区域内所有元素的和。
    -   这个数组可以通过递推关系来计算：
        `prefix_sum[i][j] = a[i][j] + prefix_sum[i-1][j] + prefix_sum[i][j-1] - prefix_sum[i-1][j-1]`
    -   这个公式的含义是：当前区域的和等于它本身的值，加上它上方区域的和，加上它左方区域的和，再减去左上方被重复计算的区域的和。
    -   这个预处理过程的时间复杂度是 $O(n \times m)$。

2.  **查询：计算任意矩形区域的和**
    -   一旦我们有了前缀和数组，计算任意一个以 `(x1, y1)` 为左上角，`(x2, y2)` 为右下角的矩形区域的和就变得非常简单。
    -   利用容斥原理，该区域的和为：
        `Sum(x1, y1, x2, y2) = prefix_sum[x2][y2] - prefix_sum[x1-1][y2] - prefix_sum[x2][y1-1] + prefix_sum[x1-1][y1-1]`
    -   这个公式的含义是：用 `(1,1)` 到 `(x2,y2)` 的大矩形，减去其上方的矩形和左方的矩形，再加上被重复减去的左上角矩形。
    -   每次查询只需要几次数组访问和加减法，时间复杂度为 $O(1)$。

通过这种方式，我们可以高效地响应大量的矩形区域求和查询。

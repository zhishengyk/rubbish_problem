## 问题496 题解

### 题目分析

这个问题涉及到对一个数列进行多次区间更新（给一个区间内的所有数加上一个值），然后在所有更新操作完成后，进行多次单点查询。这是一个适合使用差分数组解决的典型问题。

### 解题思路

差分数组是前缀和的逆运算，它可以将区间操作转化为单点操作，从而大大提高效率。由于所有查询都在更新之后，我们可以先完成所有更新，然后一次性地还原出最终的数组。

1.  **构造差分数组**：
    -   首先，我们根据初始数组 `A` 构造一个差分数组 `diff`。
    -   `diff[i] = A[i] - A[i-1]` (对于 `i > 1`)
    -   `diff[1] = A[1]`
    -   这样，原数组 `A` 就是 `diff` 数组的前缀和。

2.  **处理区间更新**：
    -   当我们要给区间 `[L, R]` 的所有数增加 `X` 时，这会影响到差分数组的两个位置：
        -   `diff[L]` 增加 `X`。
        -   `diff[R+1]` 减少 `X`。
    -   我们对所有 `q` 次操作都执行这样的修改。每个更新操作的时间复杂度是 $O(1)$。

3.  **还原最终数组**：
    -   在处理完所有 `q` 次更新后，我们得到了最终的差分数组。
    -   我们可以通过对差分数组求前缀和来还原出最终的数组 `A'`。
    -   `A'[i] = A'[i-1] + diff[i]`
    -   这个还原过程的时间复杂度是 $O(n)$。

4.  **响应查询**：
    -   在得到最终的数组 `A'` 后，对于每个查询 `num`，我们直接输出 `A'[num]` 即可。每次查询的时间复杂度是 $O(1)$。

这个算法的总时间复杂度是 $O(n + q + p)$，非常高效。

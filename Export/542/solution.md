## 问题542 题解

### 题目分析

这是一个综合性的中缀表达式处理问题，包含三个主要步骤：
1.  **合法性检查**：判断输入的中缀表达式是否符合语法规则。
2.  **中缀转后缀**：如果合法，将中缀表达式转换为后缀表达式（逆波兰表示法）。
3.  **后缀求值**：计算转换后的后缀表达式的值。

这个问题是栈应用的经典集合。

### 解题思路

#### 1. 合法性检查

- **括号匹配**：使用栈检查左右括号是否正确配对。
- **运算符规则**：
  - 两个运算符不能直接相邻（例如 `a++b` 或 `a*/b`），但一元减号（或加号）是例外，它必须出现在表达式开头或左括号后面。
  - 表达式不能以二元运算符结尾。

#### 2. 中缀转后缀 (Dijkstra's Shunting-yard Algorithm)

- **核心数据结构**：
  - 一个队列或字符串 `postfix` 用于存放输出的后缀表达式。
  - 一个栈 `ops` 用于存放运算符和左括号。
- **算法流程**：
  1. 从左到右遍历中缀表达式。
  2. **遇到数字**：直接追加到 `postfix`。
  3. **遇到左括号 `(`**：压入 `ops` 栈。
  4. **遇到右括号 `)`**：将 `ops` 栈顶的运算符弹出并追加到 `postfix`，直到遇到左括号。将左括号从 `ops` 栈中弹出并丢弃。
  5. **遇到运算符 `op`**：
     - 当 `ops` 栈不为空，且栈顶不是左括号，并且栈顶运算符的优先级**大于或等于**当前运算符 `op` 的优先级时，持续从 `ops` 栈顶弹出运算符并追加到 `postfix`。
     - 将当前运算符 `op` 压入 `ops` 栈。
  6. 遍历完中缀表达式后，将 `ops` 栈中剩余的所有运算符依次弹出并追加到 `postfix`。

#### 3. 后缀表达式求值

- **核心数据结构**：一个栈 `values` 用于存放操作数。
- **算法流程**：
  1. 从左到右遍历后缀表达式。
  2. **遇到数字**：压入 `values` 栈。
  3. **遇到运算符 `op`**：从 `values` 栈中弹出两个操作数（注意顺序，先弹出的是右操作数），执行运算，并将结果压回 `values` 栈。
  4. 遍历结束后，`values` 栈中唯一的元素就是最终结果。

## 问题492 题解

### 题目分析

这个问题要求我们找到一个长度不小于 `L` 的子区间，使得该子区间的平均值最大。这是一个典型的最优比率规划问题，通常使用二分答案的方法来解决。

### 解题思路

直接求解最大平均值很困难，但判断一个给定的平均值 `avg` 是否可行则相对容易。这启发我们使用二分法。

1.  **二分答案**：我们在一个足够大的范围内（例如 `[0, max(A)]`）对可能的平均值 `avg` 进行二分搜索。

2.  **检验函数 `check(avg)`**：对于一个给定的 `avg`，我们需要判断是否存在一个长度不小于 `L` 的子区间 `[i, j]`，其平均值大于或等于 `avg`。
    $$ \frac{\sum_{k=i}^{j} a_k}{j-i+1} \ge avg $$
    这个不等式可以变形为：
    $$ \sum_{k=i}^{j} a_k \ge avg \times (j-i+1) $$
    $$ \sum_{k=i}^{j} (a_k - avg) \ge 0 $$

3.  **问题转化**：我们定义一个新数组 `b`，其中 `b_k = a_k - avg`。现在，问题就转化为了：**在新数组 `b` 中，是否存在一个长度不小于 `L` 的子区间，其和大于或等于 0？**

4.  **解决转化后的问题**：这个问题可以用前缀和来解决。
    -   计算 `b` 数组的前缀和 `prefix_sum_b`。
    -   我们要寻找是否存在 `i, j` 满足 `j-i+1 >= L` 且 `prefix_sum_b[j] - prefix_sum_b[i-1] >= 0`。
    -   这等价于 `prefix_sum_b[j] >= prefix_sum_b[i-1]`。
    -   我们可以遍历 `j` 从 `L` 到 `n`。对于每个 `j`，我们需要找到它前面（在 `0` 到 `j-L` 的范围内）的最小前缀和 `min_prefix`。如果 `prefix_sum_b[j] >= min_prefix`，那么我们就找到了一个满足条件的子区间，`check(avg)` 返回 `true`。
    -   在遍历 `j` 的过程中，`min_prefix` 可以被高效地维护。

5.  **更新二分边界**：
    -   如果 `check(avg)` 返回 `true`，说明 `avg` 是一个可行的平均值，我们尝试寻找更大的平均值，即 `left = avg`。
    -   如果 `check(avg)` 返回 `false`，说明 `avg` 太大了，我们需要减小它，即 `right = avg`。

通过不断迭代，`left` 和 `right` 会逼近最终的答案。
